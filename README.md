# Измеритель расстояния на STM32 с HC-SR04, LCD1602 и PWM-индикацией.

Этот проект реализует **измеритель расстояния** на базе **ультразвукового датчика HC-SR04** и микроконтроллера **STM32F103C8T6 (Blue Pill)**. Расстояние отображается на **LCD1602 по I2C**, а также используются **светодиоды и зуммер с PWM-управлением** для индикации близости объектов.
---

## Скриншоты и видео

- [Конфигурация в CubeMX](https://github.com/user-attachments/assets/e23de54b-0466-4e76-ac48-c7fb93afa050)
- [Видео](https://youtube.com/shorts/hrjaTZsLUqA?feature=share)

---

## Возможности

- Точное измерение расстояния в сантиметрах
- Вывод значений на LCD1602 по I2C
- Плавная индикация расстояния с помощью 4 светодиодов (PWM)
- Зуммер с изменяющимся уровнем сигнала при приближении
- Модульный код на основе HAL + DWT-задержек

---

## Используемые компоненты

| Компонент         | Назначение                             |
|-------------------|----------------------------------------|
| STM32F103C8T6     | Микроконтроллер ("Blue Pill")          |
| HC-SR04           | Ультразвуковой датчик расстояния       |
| LCD1602 + I2C     | 16x2 символов, через модуль PCF8574    |
| Светодиоды (x4)   | Индикация расстояния (PWM на TIM3)     |
| Зуммер            | Звуковая индикация (PWM на TIM2_CH1)   |

---

## Подключение

| Назначение         | Пин STM32        | Примечание                    |
|--------------------|------------------|-------------------------------|
| TRIG               | PA0              | Выход на TRIG HC-SR04         |
| ECHO               | PA1              | Вход с ECHO HC-SR04           |
| LCD1602 (I2C)      | PB6 / PB7        | I2C1 (SCL / SDA)              |
| LED 1              | PA6 (TIM3_CH1)   | Ближний cветодиод             |
| LED 2              | PA7 (TIM3_CH2)   |                               |
| LED 3              | PB0 (TIM3_CH3)   |                               |
| LED 4              | PB1 (TIM3_CH4)   | Дальний cветодиод             |
| Buzzer             | PA15 (TIM2_CH1)  | Зуммер                        |

---

## Конфигурация периферии в STM32CubeMX:

|Периферия |                Настройки                  |
|----------|-------------------------------------------|
|I2C1	   |SDA — PB7, SCL — PB6                       | 
|(PCF8574) |Режим: I2C                                 |
|          |Скорость: 100 кГц (Standard Mode)          |
|TIM2	   |CH1 — PA15,                                |
|(Buzzer)  |Режим: PWM Generation CH1                  |
|          |Prescaler: 71                              |
|          |Period: 333                                |
|TIM3      |CH1 — PA6, CH2 — PA7, CH3 — PB0, CH4 — PB1 |
|(LED's)   |Режим: PWM Generation CH1–CH4              |
|          |Prescaler: 71                              |
|          |Period: 999                                |
|GPIO      |Trigger: PA0 — выход (Push Pull)           |
|(HC-SR04) |Echo: PA1 — вход (Pull-down)               |

---

## Зоны расстояний и поведение

| Расстояние (см)  | Светодиоды     | PWM зуммера          |
|------------------|----------------|----------------------|
| > 40             | Все выключены  | Без звука            |
| 30 – 40          | LED1 включается| 30 / 1000 (низкий)   |
| 20 – 30          | LED2           | 150 / 1000 (средний) |
| 10 – 20          | LED3           | 300 / 1000 (высокий) |
| 0 – 10           | LED4           | 700 / 1000 (максимум)|

---

## Структура проекта
```
stm32-ultrasonic-distance/
├── Core/                     # Исходники и заголовки проекта
│ ├── Inc/                    # Заголовочные файлы (.h)
│ └── Src/                    # Исходные файлы (.c)
├── Drivers/                  # Драйверы STM32 HAL
├── .gitignore                # Исключения Git
├── HY-SRF05_LCD1602_HAL.ioc  # STM32CubeMX файл конфигурации
└── README.md                 # Документация
```

---
## Сборка и запуск

1. Открой файл `HY-SRF05_LCD1602_HAL.ioc` в **STM32CubeIDE**
2. Сгенерируй и собери проект (`Ctrl + B`)
3. Прошей устройство через ST-Link
4. Подключи модули по таблице выше
5. Смотри результат на экране и светодиодах
- [Подключение ST-LINK V2](https://github.com/user-attachments/assets/11cf20ef-1757-43f4-bd80-f0e9caa32841)
---

## Особенности реализации

- Используется **DWT (Data Watchpoint and Trace)** для точных задержек в микросекундах.
- Частоты и коэффициенты заполнения PWM можно изменять через TIM2 и TIM3.
- Обновление LCD и управление яркостью сделано через HAL без блокировок.